cmake_minimum_required(VERSION 2.6)

enable_language(ASM-ATT)

set(SOURCE_FILES 
	src/abort.c
	src/abs.c
	src/asctime.c
	src/assert.c
	src/atexit.c
	src/atof.c
	src/atoi.c
	src/atol.c
	src/atoll.c
	src/bcmp.c
	src/bcopy.c
	src/bsearch.c
	src/btowc.c
	src/bzero.c
	src/calloc.c
	src/clearerr.c
	src/clock.c
	src/_crt.c
	src/ctime.c
	src/ctype.c
	src/difftime.c
	src/div.c
	src/errno.c
	src/exit.c
	src/_Exit.c
	src/fclose.c
	src/fegetexceptflag.c
	src/feholdexcept.c
	src/feof.c
	src/ferror.c
	src/fesetexceptflag.c
	src/feupdateenv.c
	src/fflush.c
	src/ffs.c
	src/fgetc.c
	src/fgetpos.c
	src/fgets.c
	src/fgetwc.c
	src/fgetws.c
	src/fopen.c
	src/fprintf.c
	src/fputc.c
	src/fputs.c
	src/fputwc.c
	src/fputws.c
	src/fread.c
	src/free.c
	src/freopen.c
	src/fscanf.c
	src/fseek.c
	src/fsetpos.c
	src/ftell.c
	src/fwide.c
	src/fwprintf.c
	src/fwrite.c
	src/fwscanf.c
	src/getchar.c
	src/getenv.c
	src/gets.c
	src/getwchar.c
	src/gmtime.c
	src/imaxabs.c
	src/imaxdiv.c
	src/index.c
	src/labs.c
	src/ldiv.c
	src/llabs.c
	src/lldiv.c
	src/localeconv.c
	src/localtime.c
	src/malloc.c
	src/mblen.c
	src/mbrlen.c
	src/mbrtowc.c
	src/mbsinit.c
	src/mbsrtowcs.c
	src/mbstowcs.c
	src/mbtowc.c
	src/memchr.c
	src/memcmp.c
	src/memcpy.c
	src/memmove.c
	src/memset.c
	src/mktime.c
	src/perror.c
	src/printf.c
	src/_printf_engine.c
	src/putchar.c
	src/puts.c
	src/putwchar.c
	src/qsort.c
	src/raise.c
	src/rand.c
	src/realloc.c
	src/remove.c
	src/rename.c
	src/rewind.c
	src/rindex.c
	src/scanf.c
	src/setbuf.c
	src/setlocale.c
	src/setvbuf.c
	src/signal.c
	src/snprintf.c
	src/sprintf.c
	src/srand.c
	src/sscanf.c
	src/stdio.c
	src/stdlib.c
	src/strcasecmp.c
	src/strcat.c
	src/strchr.c
	src/strcmp.c
	src/strcoll.c
	src/strcpy.c
	src/strcspn.c
	src/strdup.c
	src/strerror.c
	src/strftime.c
	src/strlcat.c
	src/strlcpy.c
	src/strlen.c
	src/strncasecmp.c
	src/strncat.c
	src/strncmp.c
	src/strncpy.c
	src/strndup.c
	src/strpbrk.c
	src/strrchr.c
	src/strspn.c
	src/strstr.c
	src/strtod.c
	src/strtof.c
	src/strtoimax.c
	src/strtok.c
	src/strtol.c
	src/strtold.c
	src/strtoll.c
	src/strtoul.c
	src/strtoull.c
	src/strtoumax.c
	src/strxfrm.c
	src/swprintf.c
	src/swscanf.c
	src/system.c
	src/time.c
	src/tmpfile.c
	src/tmpnam.c
	src/ungetc.c
	src/ungetwc.c
	src/vfprintf.c
	src/vfscanf.c
	src/vfwprintf.c
	src/vfwscanf.c
	src/vprintf.c
	src/vscanf.c
	src/vsnprintf.c
	src/vsprintf.c
	src/vsscanf.c
	src/vswprintf.c
	src/vswscanf.c
	src/vwprintf.c
	src/vwscanf.c
	src/wcrtomb.c
	src/wcscat.c
	src/wcschr.c
	src/wcscmp.c
	src/wcscoll.c
	src/wcscpy.c
	src/wcscspn.c
	src/wcsftime.c
	src/wcslen.c
	src/wcsncat.c
	src/wcsncmp.c
	src/wcsncpy.c
	src/wcspbrk.c
	src/wcsrchr.c
	src/wcsrtombs.c
	src/wcsspn.c
	src/wcsstr.c
	src/wcstod.c
	src/wcstof.c
	src/wcstoimax.c
	src/wcstok.c
	src/wcstol.c
	src/wcstold.c
	src/wcstoll.c
	src/wcstombs.c
	src/wcstoul.c
	src/wcstoull.c
	src/wcstoumax.c
	src/wcswidth.c
	src/wcsxfrm.c
	src/wctob.c
	src/wctomb.c
	src/wctype.c
	src/wcwidth.c
	src/wmemchr.c
	src/wmemcmp.c
	src/wmemcpy.c
	src/wmemmove.c
	src/wmemset.c
	src/wprintf.c
	src/wscanf.c
)


set(MATH_SOURCE_FILES
	src/math/acos.c
	src/math/acosf.c
	src/math/acosh.c
	src/math/acoshf.c
	src/math/acoshl.c
	src/math/acosl.c
	src/math/asin.c
	src/math/asinf.c
	src/math/asinh.c
	src/math/asinhf.c
	src/math/asinhl.c
	src/math/asinl.c
	src/math/atan2f.c
	src/math/atan2l.c
	src/math/atanf.c
	src/math/atanh.c
	src/math/atanhf.c
	src/math/atanhl.c
	src/math/atanl.c
	src/math/cbrt.c
	src/math/cbrtf.c
	src/math/cbrtl.c
	src/math/ceilf.c
	src/math/ceill.c
	src/math/copysignf.c
	src/math/copysignl.c
	src/math/cos.c
	src/math/cosf.c
	src/math/cosh.c
	src/math/coshf.c
	src/math/coshl.c
	src/math/cosl.c
	src/math/erf.c
	src/math/erfc.c
	src/math/erfcf.c
	src/math/erfcl.c
	src/math/erff.c
	src/math/erfl.c
	src/math/exp2.c
	src/math/exp2f.c
	src/math/exp2l.c
	src/math/exp.c
	src/math/expf.c
	src/math/expl.c
	src/math/expm1.c
	src/math/expm1f.c
	src/math/expm1l.c
	src/math/fabsf.c
	src/math/fabsl.c
	src/math/fdim.c
	src/math/fdimf.c
	src/math/fdiml.c
	src/math/floorf.c
	src/math/floorl.c
	src/math/fma.c
	src/math/fmaf.c
	src/math/fmal.c
	src/math/fmax.c
	src/math/fmaxf.c
	src/math/fmaxl.c
	src/math/fmin.c
	src/math/fminf.c
	src/math/fminl.c
	src/math/fmodf.c
	src/math/fmodl.c
	src/math/frexp.c
	src/math/frexpf.c
	src/math/frexpl.c
	src/math/hypot.c
	src/math/hypotf.c
	src/math/hypotl.c
	src/math/ilogb.c
	src/math/ilogbf.c
	src/math/ilogbl.c
	src/math/ldexp.c
	src/math/ldexpf.c
	src/math/ldexpl.c
	src/math/lgamma.c
	src/math/lgammaf.c
	src/math/lgammal.c
	src/math/llrint.c
	src/math/llrintf.c
	src/math/llrintl.c
	src/math/llround.c
	src/math/llroundf.c
	src/math/llroundl.c
	src/math/log10f.c
	src/math/log10l.c
	src/math/log1p.c
	src/math/log1pf.c
	src/math/log1pl.c
	src/math/log2.c
	src/math/log2f.c
	src/math/log2l.c
	src/math/logb.c
	src/math/logbf.c
	src/math/logbl.c
	src/math/logf.c
	src/math/logl.c
	src/math/lrint.c
	src/math/lrintf.c
	src/math/lrintl.c
	src/math/lround.c
	src/math/lroundf.c
	src/math/lroundl.c
	src/math/modf.c
	src/math/modff.c
	src/math/modfl.c
	src/math/nan.c
	src/math/nanf.c
	src/math/nanl.c
	src/math/nearbyint.c
	src/math/nearbyintf.c
	src/math/nearbyintl.c
	src/math/nextafter.c
	src/math/nextafterf.c
	src/math/nextafterl.c
	src/math/nexttoward.c
	src/math/nexttowardf.c
	src/math/nexttowardl.c
	src/math/pow.c
	src/math/powf.c
	src/math/powl.c
	src/math/remainder.c
	src/math/remainderf.c
	src/math/remainderl.c
	src/math/remquo.c
	src/math/remquof.c
	src/math/remquol.c
	src/math/rint.c
	src/math/rintf.c
	src/math/rintl.c
	src/math/roundf.c
	src/math/roundl.c
	src/math/scalbln.c
	src/math/scalblnf.c
	src/math/scalblnl.c
	src/math/scalbn.c
	src/math/scalbnf.c
	src/math/scalbnl.c
	src/math/sinf.c
	src/math/sinh.c
	src/math/sinhf.c
	src/math/sinhl.c
	src/math/sinl.c
	src/math/sqrtf.c
	src/math/sqrtl.c
	src/math/tan.c
	src/math/tanf.c
	src/math/tanh.c
	src/math/tanhf.c
	src/math/tanhl.c
	src/math/tanl.c
	src/math/tgamma.c
	src/math/tgammaf.c
	src/math/tgammal.c
	src/math/truncf.c
	src/math/truncl.c
)

set(ARCH_SOURCE_FILES
	src/arch/x86_64/longjmp.s
	src/arch/x86_64/setjmp.s
	src/arch/x86_64/atan2.c
	src/arch/x86_64/atan.c
	src/arch/x86_64/ceil.c
	src/arch/x86_64/copysign.c
	src/arch/x86_64/fabs.c
	src/arch/x86_64/fenv.c
	src/arch/x86_64/floor.c
	src/arch/x86_64/fmod.c
	src/arch/x86_64/log10.c
	src/arch/x86_64/log.c
	src/arch/x86_64/round.c
	src/arch/x86_64/sin.c
	src/arch/x86_64/sqrt.c
	src/arch/x86_64/trunc.c
)

set(SYS_SOURCE_FILES
	heap.cc
	_support.cc
	src/arch/x86_64/_start.s
)

add_library (c STATIC  ${SOURCE_FILES} ${MATH_SOURCE_FILES} ${ARCH_SOURCE_FILES})
add_executable (libc-test ${SYS_SOURCE_FILES} test.c)

target_include_directories (c PUBLIC 
	${CMAKE_CURRENT_SOURCE_DIR} 
	${CMAKE_CURRENT_SOURCE_DIR}/include
	${CMAKE_CURRENT_SOURCE_DIR}/include/arch/x86_64
)

add_definitions("-DENABLE_FPU")

set_property(TARGET c PROPERTY C_STANDARD 99)
set_property(TARGET libc-test PROPERTY C_STANDARD 99)

target_link_libraries(libc-test LINK_PUBLIC c)

set(CMAKE_C_FLAGS   "${CMAKE_C_FLAGS} -pedantic -W -Wall -ffreestanding")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -pedantic -W -Wall -ffreestanding")
set(CMAKE_EXE_LINKER_FLAGS  "${CMAKE_EXE_LINKER_FLAGS} -nostdlib")
#-static 
